# Logit/Probit Regression

Welcome

#< ignore

```{r "Create problem set files"}
library(RTutor)
setwd("D:/Mes Donnees/__modelesR/RTutor/Logit/Logit")
ps.name = "Logit"; sol.file = paste0(ps.name,"_sol.Rmd")
libs = c("readxl", "tidyverse") # 

create.ps(sol.file=sol.file, ps.name=ps.name, user.name=NULL, libs=libs, var.txt.file = "variables.txt",addons = "quiz")

show.ps(ps.name, user.name = "Damien", launch.browser=TRUE,
  auto.save.code=FALSE, sample.solution=FALSE)
```

#> 



## Exercise 2: Check -- Check the data

We will check the data set. Each exercise are created so they do not depend on the previous one. So we will first need to import the data again. To be sure, you remember the commands, you will need to import the data again.

**Task:** Import the data from `wells.xlsx` and save them in a data.frame named `wells`. In a second line of code, use the command `head` to view the first records of the data frame you have just created

```{r "2 import"}
#< task
# replace the #... with your codes
# ...
# ...
#>
wells <- read_excel("wells.xlsx")
head(wells)
#< hint
display("On the first line, wells <- read_excel(\"wells.xlsx\"). On the second line, type:  head(wells)")
#>
```

#### Transform binary variables into factor

To facilitate data analysis, we will transform some of the variables. The first transformation is to change the variable `switch`, currently a numeric variable into a factor variable. (Click on the info button just below if you do not know what a factor is)

#< info "Factors"
A factor is a data type in R that was developed to work with nomimal variables. If you are new to factors in R, here are 2 references to check before you go further:

If you prefer video explanations, check this link: <a href="https://www.youtube.com/embed/xkRBfy8_2MU" target="_blank">R tutorial - Using Factors in R by DataCamp </a>

If you prefer text explanations, check this link: <a href="https://www.stat.berkeley.edu/~s133/factors.html" target="_blank">Factors in R </a>
#>

**Task**: 

1. Create a new factor by converting the numerical variable `switch` into a factor variable, where the labels of the levels are changed according to the rule 1 -> "Changed", 0 -> "Kept", and will be used in that order. Name your newly created variable `changed`

2. View the first values of the variable to check the results obtained

```{r "2 factor"}
#< task
# type your commands here
#>
wells$changed <- factor(wells$switch, levels= c(1,0), labels=c("Changed", "Kept"))
head(wells$changed)
#< hint
display("You must apply the function `factor` to a the variable switch. Do not forget to specify the levels and the labels. Do not forget to create a new variable and do not forget to indicate that the variable `switch` and the variables `changed` belongs to the data frame `wells`.  ")
#>
```

#### Summarize the data

#< info "`summary` applied to a data.frame object"
The command `summary` can be applied to different R objects, e.g. data frames, model results, etc. When applied to a data frame, it will output the basic statistics (minimum, maximum, mean, quartiles) of all the variables

To summarize the variables on the data frame `data`, use the command
```{r "2 info_summary",eval=FALSE}
summary(data)
```
#>

The command `summary` is helpful to get a rapid overview of the data.

```{r "2 summary"}
#< task
# type your command
#>
summary(wells)
#< hint
display("Write: summary(xxx)  where xxx is the name of the data frame. Then press check.")
#>
```

### Making plots

#### One variable plot 

Another way to check the data that you will be using is to draw some plots to identify potential outliers. The easiest way to do this is to use the function `plot()` with one variable.

*Task* :  Plot the variable `arsenic` 

```{r "2 plotuni"}
#< task
# type your command
#>
plot(wells$arsenic)
#< hint
display("Apply the function plot to a the variable arsenic; do not forget to tell that arsenic belongs to the data frame 'wells' ")
#>
```

#### Two variables scatterplot 

*Task* :  Plot the variable `arsenic` against the variable  `dist` 

```{r "2 plot2"}
#< task
# type your command
#>
plot(wells$arsenic, wells$dist)
#< hint
display("Apply the function plot with the two variables separated by a comma; Do not forget to state that the variables belong to the dataset wells ")
#>
```


### Graphical examination of the relations

We want to know how the decision to switch (the response variable) is related to some exogenous/explanatory variables (arsenic, dist, assoc and educ). It is good practice to begin with some simple graphical examination of the data before undertaking any formal modelling. 


#< info "spine plots and spinograms"

The command `spineplot(y ~ x)` will plot $P(y | x)$ against $P(x)$ where both $x$  is a explanatory variable and $y$ is a dependent variable. $y$ will be either a *binary* or *multinomial* variable (In R, the best way is to convert the initial numerical variable into a *factor*). Both quantities are approximated by the corresponding empirical relative frequencies.

When $x$ is discrete (multinomial), we obtain a spine plot. When $x$ is numerical, $x$ is first discretized and then empirical relative frequencies are taken, we obtain a spinogram.

Thus, spine plots can also be seen as a generalization of stacked bar plots where:

  + the width of a bar corresponds to the relative frequency of x
+ the height of a bar corresponds to the relative frequency of y for the given x.

For example, the command:
```{r "2 info_spine1", echo=TRUE, warning=FALSE, eval=FALSE}
ww <-spineplot(changed ~ arsenic, data = wells, breaks = 10)
ww
```
will produce the following spinogram:

```{r "2 info_spine2", echo=FALSE, warning=FALSE, message= FALSE, fig.height= 3, fig.asp = 0.7}
library(readxl)
library(tidyverse)
wells <- read_excel("wells.xlsx")
wells$changed <- factor(wells$switch, levels= c(0,1), labels=c("Keep", "Change"))
wells %>% filter(dist < 250, arsenic < 7.5) -> wells_filtered
ww <-spineplot(changed ~ arsenic, data = wells, breaks=10)
ww
```

Here, the `arsenic` variable was discretized into 11 groups of arsenic levels. For each group, we have a relative frequency of observed actions (changed vs. kept)

First, we observe that around 46% of the households having a well with aresnic levels between 0 and 1 switched to another well (492/(492+565)) and that switching wells increased with the levels of arsenic in the initial well. We can build the hypothesis that the probability to switch well was related to the level of arsenic found in the well.

Second, we also observe that wells with levels of arsenic that are higher than 4 are not very common. We will have to bear this in mind when analyzing our results.

#>


As an exercise you will create spinogram to visualize how the proportions of factor variable `change`  evolve with the numerical variables `dist`. 

**Task:**  Construct the spinogram of the dependent variable `changed` and the independent variable `dist`. To do this, follow the example given *spine plots and spinograms* info box.


```{r "2 spinograms"}
#< task
# type your command here
#>
spineplot(formula=changed ~ dist, data = wells)

#< hint
display("Refer to the syntax in the Info box and change the name of the variable ")
#>
```

**Quiz**

#< quiz "Interpret a spinogram"
Question: Based on the spinogram obtained in the previous task, tick the statements that you find true (Multiple answers are correct)
mc:  
  - The bars (20-40) is wider that the bar (120-140). This means there are less observations of new wells that are situated at 20-40 m than wells situated at 120-140 m
  - The bars (20-40) is wider that the bar (120-140). This means there are more observations of new wells that are situated at 20-40 m than wells situated at 120-140 m*
  - The frequency of households that changed for a new well decreased with the distance?*
  - We should expect some significant negative relation between distance and change of wells*
  - We should expect some significant positive relation between distance and change of wells
  - We do not expect any correlation between distance and change of wells
success: Great, your choices are correct! 
failure: Try again.
#>


Write your answer text inside the quotes " " as an R String and press `Check`.
(Note that you always see afterwards the message "Great, solved correctly."
 But your answer will in fact be graded after you submit your problem set.)
   
```{r "2comment",results='hide'}
#< task_notest
" 
Insert your answer here in those quotes
  
  
  
  
  
"
#>
""
#< test
holds.true(TRUE)
#>

